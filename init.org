#+TITLE: drmrd's Emacs Init File
#+AUTHOR: drmrd
#+OPTIONS: toc:nil num:nil ^:nil
#+PROPERTY: header-args    :comments link :eval query :results output silent
#+STARTUP: indent

* General Information/Notes
** What should go into init.org?
The init.org file is loaded at startup, rather than on demand. Hence
it should contain any and all Emacs settings that you'd like loaded
every session. Accordingly, good examples of what code this file
should contain are

- Loading packages that are used in all major modes
- Emacs customizations that affect the editor's UI
- All global settings. These include globally-defined keybindings,
  the default major mode for new files, etc.
- Global theme customizations

** Emacs Configuration Files Hierarchy
At present, init.org loads files written by me from _one_ place:
*** ~/.emacs.d/lib
The new folder for storing .org files, intended to contain libraries
meant for customizing, e.g., specific major modes (in ways that go
beyond the scope of this file). For instance, the file [[~/workspace/elisp/emacs_latex.el][emacs_latex.el]]
from the folder ~/workspace/elisp is being converted into a human
readable .org file [[~/.emacs.d/lib/latex.org][latex.org]] in this new directory.

init.org loads all .org files in this directory by default, unless
told to do otherwise.

This is also the location best suited for large functions or
collections thereof whose contents is appropriate for init.org but
would add hundreds or thousands of lines of code unnecessarily.

**** TODO List all libraries of the latter type here
**** TODO List any libraries in ~/.emacs.d/lib/ not loaded by default here.

**** Rules for creating new libraries in .emacs.d/lib/
***** For Customizing a Major Mode:
- Add a new bullet in the [[*Major%20Mode%20Customization][Major Mode Customization]] section below
  containing the name of the mode or (for multiple, related modes) the
  relevant environment name (e.g. [[*LaTeX%20Modes][LaTeX Modes]] is used below when
  loading libraries for all TeX-related packages.)
- There should be a single configuration file for each bullet in [[*Major%20Mode%20Customization][Major
  Mode Customization]], typically of the form bullet_title.org. That
  file should then load any relevant packages.
****** What To Do When a Major Mode Configuration Library Gets Too Big
- Keep the bullet_title.org file
- Create a ~/.emacs.d/lib/bullet_title subdirectory
- Add libraries to this subdirectory and load them from
  bullet_title.org
*** ~/elisp
This is the location in which all third party scripts should be
placed. They should NOT be placed here manually, however. Instead, add
an entry for each new script into the makefile in that directory, then
install them from the command line as byte-compiled elisp files.
*** ~/workspace/elisp [[*NOTE:%20This%20folder%20should%20be%20considered%20OBSOLETE.][(OBSOLETE)]]
This is the old location for storing .el files. It should be replaced
by literate programming .org files in the folder ~/.emacs.d/lib/

init.org loads all .el files in this directory, unless told to do
otherwise.

**** DONE List any exceptions to this loading rule here.
This is considered done, since the folder is obsolete.
**** DONE NOTE: This folder should be considered OBSOLETE.
CLOSED: [2015-12-02 Wed 15:54]
No new elisp libraries should be added here. Due to some undesirable
effects of the code in these old .el files, the original directory has
been renamed elisp.bak. Any configuration files/settings needed that
are in elisp.bak should be integrated into org files in the .emacs.d
directory.

(This was really completed much earlier than the close date/time.)
*** ~/.emacs.d/
Adding libraries to the root .emacs.d directory should ONLY happen if
they implement/customize features affecting all major modes by default
AND contain too much code for this file.

A good use case for such a file is indentation.org, which contains
settings for all global tweaks to how indentation and filling are done
in Emacs.

Eventually, it may very well be that I stop doing this entirely,
loading these configuration files from, e.g., a .emacs.d/lib/global
subdirectory, to help avoid namespace collisions with third party
packages.
** Notes on Aquamacs Configuration Oddities
Since Aquamacs is obnoxious, my .emacs and .emacs.d files were
originally found in

    ~/Library/Preferences/Aquamacs Emacs/Preferences.el

and

    ~/Library/Preferences/Aquamacs Emacs/

respectively. Now that I'm using this Literate Emacs Init file,
there's no need to store them there, and Preferences.el simply loads
org-babel and points it here.

When opened Aquamacs loads elisp code contained in the following files:

    ~/.emacs
    ~/Library/Preferences/Aquamacs Emacs/Preferences.el
    ~/Library/Preferences/Aquamacs Emacs/customizations.el

where the last file is automatically written when you "Save Options"
in an Aquamacs menu. The advantage to using the god-awfully-located
Preferences.el file is that it overrides automatically-generated
customizations like code in .emacs should but doesn't.

Aquamacs will also find libraries contained in

    ~/Library/Preferences/Aquamacs Emacs/Preferences.el

which is why I originally moved mine there from "~/.emacs.d".
** FAQ
*** Q: How can I interactively evaluate lisp statements?         :QUESTION:
**** A: Call =ielm= (*Inferior Emacs Lisp Mode*)
=ielm= (Inferior Emacs Lisp Mode) is essentially an elisp shell
environment, used exactly for this purpose. It's way, WAY easier than,
e.g., writing and evaluating statements in =*Scratch*=. When you run
=ielm= (which is done with the command =M-x ielm=) a new =*ielm*=
buffer is created that serves as the elisp shell.

This is great for evaluating code as you go and designing new
functions.
*** Q: How can I access a complete list of variables defined by a package? :QUESTION:
**** A: The easy (if not completely reliable) way
Use =describe-variable= via "C-h v", type the name of the package (or
part of it) in the minibuffer, and then tab twice to get an
autocompletion list. Since a typical package will begin its variable
names with its own name, this generates a reasonably complete list.
** Elisp Notes and Techniques
*** Q: What's an alist?
**** A: An association list
An alist is a list =mylist= of cons cells =(car . cdr)= (in dotted
pair notation) and atoms. For example:

#+BEGIN_EXAMPLE
  (setq mylist
    '((setting1 . value1)
     (setting2 . value2)
     (setting3 . value3)))
#+END_EXAMPLE

sets =mylist= equal to an alist. In each cons cell =(setting
. value)=, the CAR =setting= is called a *key* and the CDR =value= a
*value*. A key (or value) corresponding to a value (or key) is called
an *association* for the key (or value) in =mylist=.

The following functions are commonly used to retrieve data from
alists.

| Function                     | Description                   | Example                          |
|------------------------------+-------------------------------+----------------------------------|
| (assoc key alist)            | Returns the first association | (assoc 'setting1 mylist)         |
|                              | to =key= in =alist=           | returns value1                   |
| (rassoc value alist)         | Returns the first association | (assoc 'value1 mylist)           |
|                              | to =value= in =alist=         | returns setting1                 |
| (assq key alist)             | Like =assoc= but uses =eq=    |                                  |
|                              | for comparison instead        |                                  |
|                              | of =equal= which is faster    |                                  |
|                              | (but useless when things      |                                  |
|                              | other than symbols appear as  |                                  |
|                              | keys in the alist)            |                                  |
| (rassq key alist)            | Like =rassoc= but uses =eq=   |                                  |
|                              | for comparison, just like the |                                  |
|                              | last function                 |                                  |
| (assoc-default key alist     | TODO: Fill this in            |                                  |
| &optional test default)      |                               |                                  |
| (copy-alist alist)           | Returns a two-level deep copy |                                  |
|                              | of the given alist            |                                  |
| (assq-delete-all key alist)  | Delete every element from the | (setq mylist '((a 1) (b 1) (a 2) |
|                              | alist with a CAR matching the | (b 3) (b 4) (b 5) (a 3) (c 2)))  |
|                              | given key, and return the new | (assq-delete-all 'a mylist)      |
|                              | list. This                    | returns                          |
|                              | often-but-unpredictably       | ((b 1) (b 3) (b 4) (b 5) (c 2))  |
|                              | modifies the passed alist,    |                                  |
|                              | and so only the returned      |                                  |
|                              | alist should be used after    |                                  |
|                              | invoking this function.       |                                  |
| (rassq-delete-all key alist) | Like the last function but    |                                  |
|                              | compares CDRs to the given    |                                  |
|                              | key instead of CARs.          |                                  |
*** Q: When should I use apostrophes?
**** A: To return an object/variable name without evaluating it.
The code ='object= is short for =(quote object)=, which is a special
form that returns =object= without evaluating it. This is useful, for
instance, when you would like to change the value of a variable,
append elements to a list, add un-evaluated elisp code to some other
object, etc.

***** Example: A variable called =Paddington=
Let's say you have a variable named =Paddington=, and you wish to
replace its value with the string "A Bear Called Paddington". This can
be achieved as follows:
#+BEGIN_EXAMPLE
  (setq Paddington "A Bear Called Paddington")
#+END_EXAMPLE
Note that quoting is unnecessary here, since =(setq foo bar)= sets the
/literal/ symbol =foo= to the value =bar= (so in some sense quotes
=Paddington= without our intervention).

Indeed, if you want to get unnecessarily fancy here (and to emphasize
what the apostrophe is doing) you could execute the following
equivalent code, too:
#+BEGIN_EXAMPLE
  (setq Paddington (concat "A Bear Called " (symbol-name 'Paddington)))
#+END_EXAMPLE
Note that we can't just use =(concat "A Bear Called " 'Paddington)=
here, since ='Paddington= is really a /symbol/, not a /string/. (See
the emacs documentation for variables and symbols.)

***** Example: Prepending to a list
Suppose you have a list variable named =mylist= and you'd like to add
the string "A Bear Called Paddington" to it. In conjunction with the
=add-to-list= function, you can use quoting to achieve this:
#+BEGIN_EXAMPLE
  (add-to-list 'mylist "A Bear Called Paddington")
#+END_EXAMPLE
You can also add the string to the end of this list by setting the first
optional argument of =add-to-list= to =t= (or anything non-nil).
*** Add an element to a list
**** Approach 1: (add-to-list ...)
#+BEGIN_EXAMPLE
  (add-to-list LIST-VAR ELEMENT &optional APPEND COMPARE-FCN)
#+END_EXAMPLE

The =add-to-list= function prepends (by default) its second argument
=ELEMENT= to the value of the list variable in its first argument
=LIST-VAR= if it is not already present there. Adding anything non-nil
as an optional parameter =APPEND= makes =add-to-list= append the
second argument instead. Its final argument =COMPARE-FCN= (also
optional) may be a function for it to use instead of =eq= to determine
if the new element is equal to anything in the list. The new value of
the list is then returned.

***** Example 1: Unnamed =LIST-VAR=
To add 4 to an unnamed list containing 1, 2, and 3.

#+BEGIN_EXAMPLE
  (add-to-list '(1 2 3) 4)
  ; Returns (4 1 2 3)

  (add-to-list '(1 2 3) 4 t)
  ; Returns (1 2 3 4)
#+END_EXAMPLE

***** Example 2: Named =LIST-VAR=
Suppose =mylist= is a variable with value =(3 2 1)=. Then we may
prepend 4 to =mylist= with the following command:

#+BEGIN_EXAMPLE
  (add-to-list 'mylist 4)
#+END_EXAMPLE
**** Approach 2: (cons car cdr)
#+BEGIN_EXAMPLE
  (setq foo (cons car cdr))
#+END_EXAMPLE
=cons= is /the/ list creation function in elisp, and most other
functions (presumably including =add-to-list=) are built on top of
it. The command =(cons car cdr)= (short for *cons*truct) creates a
*cons cell* (aka a *non-atomic s-expression" (itself short for
"*s*ymbolic expression")), which is an object consisting of an ordered
pair of pointers CAR and CDR. Each pointer can point to any Lisp
object. The pointers CAR and CDR are often identified (in the
documentation) with the objects they point to.

By definition (in Lisp) a *list* is a series of cons cells =C1=, =C2=,
..., =Cn=, where for =k = 1,2,...,n= the CAR of =Ck= is a Lisp object
and the CDR of =Ck= is =Ck+1=, except for the CDR of =Cn= which is
=nil= (or =()=, equivalently). If the list object in the CAR of Ck is
the symbol =eltk= for each =k=, then this looks like the following:
#+BEGIN_EXAMPLE
  ;; Using cons:
  (cons elt1 (cons elt2 (cons elt3 [...] (cons eltn ()) [...])))
  ;; In dotted pair notation:
  '(elt1 . (elt2 . (elt3 [...] (eltn . ()) [...] )))
  ;; As a list
  '(elt1 elt2 elt3 [...] eltn)
#+END_EXAMPLE
Note that each =eltk= doesn't have to be atomic (or a symbol in
particular); lists may contain other lists and objects as elements.
One way to represent these visually is as follows:

#+BEGIN_EXAMPLE
    --- ---      --- ---                --- ---
   |   |   |--> |   |   |--> [...] --> |   |   |--> nil
    --- ---      --- ---                --- ---
     |            |                      |
     |            |                      |
      --> elt1     --> elt2               --> eltn
#+END_EXAMPLE
*** Replace an element in an alist
Use the assq-delete-all and rassq-delete-all commands to delete all
elements in the alist with a given CAR or CDR, and then prepend the
element of the same CAR/CDR you were replacing to the resulting list,
and set the original list equal to the result.
#+BEGIN_EXAMPLE
  (setq mylist ((car1 . cdr1) (car2 . cdr2) (car1 . cdr11) (car3 . cdr3)))
  (setq mylist (cons '(car1 . newcdr1) (assq-delete-all 'car1 mylist)))
  sets mylist equal to ((car1 . newcdr1) (car2 . cdr2) (car3 . cdr3))
#+END_EXAMPLE
*** Concatenate lists
Use the [[help:append][append]] command.

#+BEGIN_EXAMPLE
  (setq l1 '(a b c))
  (setq l2 '(x y z))
  (append l1 l2)
    => (a b c x y z)
#+END_EXAMPLE

Alternatively, use this other one-liner I cooked up while
tired. (Warning: This is probably destructive for the =a=
variable. Use at your own risk!)

#+BEGIN_EXAMPLE
  (setq a ("1" "2" "3"))
  (setq b ("4" "5" "6"))
  (car (nreverse (mapcar (lambda (elt) (push elt b)) (nreverse a))))
#+END_EXAMPLE
*** Guide: Iterating          :NOTE:elisp:lists:Control_Structures:Guide:iteration:
Elisp has native support for [[help:while][while]] loops, which, when used in
conjunction with [[help:progn][progn]] provide extremely versatile ways to iterate on
files, buffers, lists, etc. There are also various do-loop commands, such
as the built-in [[help:dolist][dolist]] and [[help:dotimes][dotimes]] commands and the versatile [[help:do][do]]
command provided by Common Lisp. If, however, you are just interested
in applying a fixed function to every member of a list then [[help:mapcar][mapcar]] is
what you're looking for.
**** while + progn == until                            :while:progn:until:
Given the definitions of while and progn, the code block
#+BEGIN_EXAMPLE
  (while (progn <sexp1>
                <sexp2>
                ...
                <sexpn>
                <sexpTest>))
#+END_EXAMPLE
will execute =<sexp1>=, =<sexp2>=, ..., =<sexpn>=, and =<sexpTest>=
and then pass the return value of =<sexpTest>= to =while= as the test
for whether or not =while= should continue. In other words, this is an
example implementation of the =repeat-until= control structure.

Note that the body of the above while loop is empty. You could make a
control structure where the expressions in =progn= are evaluated and,
if =<sexpTest>= is non-nil, then the code in the body would be called,
and then everything would repeat. Of course this could also have other
nested loops inside the test condition or body and any of them could
break out of the outer while loop using some mix of catch-throw or
encapsulation in other progn calls. For readability and simplicity of
maintenance, however, it's usually best to minimize having multiple
break points as described here and, instead, incorporate possible
break points into the progn test for the outer while loop; what you've
written in a nest chain of loops as described can usually be flattened
into a more readable single while loop.
** Elisp Style Guide                                :NOTE:elisp:Style_Guide:
Perhaps the simplest-albeit-complete, community-driven, and sensible
style guide is bbatsov's [[https://github.com/bbatsov/emacs-lisp-style-guide][Emacs Lisp Style Guide]] on GitHub. I need to
incorporate these changes into my older code and, ideally, setup
auto-fill to handle as much of this as possible and not encourage bad
practices.
*** Source Code Layout & Organization
**** Use spaces for indentation
**** For regular (that is, non-special[fn:specialfcn]) functions, vertically align function arguments
#+BEGIN_EXAMPLE
  ;; Good
  (format "%s %d"
          something
          something-else)

  ;; Bad
  (format "%s %d"
    something
    something-else)
#+END_EXAMPLE
**** If the first argument /is on a new line/, align it with the function's name
#+BEGIN_EXAMPLE
  ;; Good
  (format
   "%s %d"
   something
   something-else)

  ;; Bad
  (format
    "%s %d"
    something
    something-else)
#+END_EXAMPLE
**** Whitespace rules for special forms[fn:specialfcn]
The special argument(s) should be either on the same line as the form
name or indented by 4 spaces. The non-special arguments should be
indented by 2 spaces. It should not be aligned like a regular
function.
#+BEGIN_EXAMPLE
  ;; Good
  (when (condition)
    (action))

  ;; Bad
  (when (condition)
      (action))

  ;; Bad
  (when (condition)
        (action))

  ;; Bad
  (when
    (condition)
    (action))
#+END_EXAMPLE
***** Example: =if= forms
The if-clause (executed when the condition passed to if is non-nil) is
a special argument, so it is indented by 4 spaces.
#+BEGIN_EXAMPLE
  ;; Good
  (if (condition)
      (if-clause)
    (else-clause))

  ;; Bad
  (if (condition)
    (if-clause)
    (else-clause))
#+END_EXAMPLE
**** Vertically align =let= bindings
#+BEGIN_EXAMPLE
  ;; Good
  (let ((animalName "elephant")
        (woof "Woof!"))
    (body-clause)
    ...)

  ;; Bad
  ;; Good
  (let ((animalName "elephant")
    (woof "Woof!"))
    (body-clause)
    ...)
#+END_EXAMPLE
**** Always use CRLF (Unix) line endings
**** Separate text on the "outside" of brackets from the brackets by a space but not on the inside
#+BEGIN_EXAMPLE
  ;; Good
  (foo (bar baz) qux)

  ;; Bad
  (foo(bar baz)qux)
  (foo( bar baz )qux)

  ;; Are you even trying anymore?
  ( foo ( bar baz ) qux )
#+END_EXAMPLE
**** Place all trailing parentheses on the same line, in contact with the last form
#+BEGIN_EXAMPLE
  ;; Good
  (when (foo)
    (bar))

  ;; Bad
  (when (foo)
    (bar)
  )
#+END_EXAMPLE
**** With few exceptions, separate top-level forms with an empty line
#+BEGIN_EXAMPLE
  ;; Good
  (defvar foo ...)

  (defun bar ...)

  ;; Bad
  (defvar foo ...)
  (defun bar ...)
#+END_EXAMPLE
***** Exception: When group related definitions together
#+BEGIN_EXAMPLE
  ;; Good
  (defconst min-rows 10)
  (defconst max-rows 20)
  (defconst min-cols 15)
  (defconst max-cols 30)
#+END_EXAMPLE
** Org Mode Notes and Techniques                                       :Org:
*** Edit a code block in its default major mode (e.g. =lisp-mode= or =LaTeX-mode=)
While the pointer is in the code block hit C-c ' to open a new frame
in the correct mode containing just this code block. Hit C-x C-s to
save changes in the original buffer without closing the new one. Hit
C-c ' again to apply changes to the code block in the org file.
** Magit Notes                                                   :Magit:Git:
*** Q: How can I create a new branch from current changes and revert the current branch? :QUESTIONS:
**** A: Create a "spinoff" branch (via 'b s')
See the documentation for [[help:magit-branch-spinoff][magit-branch-spinoff]].

Here's a common problem I have. I like to tweak my configuration files
quite a bit, both on my laptop and on my office iMac, and sometimes
I'll absent mindedly make nominally conflicting changes to the same
config file on both machines. For instance, I could go to the office
to quickly grind out a writeup of some result, and realize as I'm
doing so that there is something annoying and Aquamacs-centric I need
to tweak in my config file. Naturally I'll make that change, commit it
to the working branch of the repository, and push to the remote.

Later, I might be working from home on my laptop and have some big
change I want to make and spend several hours implementing some neat
config hack. This can take several commits and plenty of time, and
once I'm done (or, worse yet, when I'm halfway through but at a
reasonable stopping point) I'll try to push these changes to the
remote. Of course, that's when I'll realize my mistake, namely that I
didn't pull the changes from the office or start a new branch several
hours ago. Now, hopefully, the changes from the office can be easily
merged into my config files without any issues, but what about when I
know I've made edits to the same portions of the files? Do I really
want to have to deal with resolving merge conflicts or reverting local
changes? Of course not! But the other options like stashing or
manually moving all of the local commits to a new branch can be quite
tedious at times.

That's where creating spinoff branches comes into play. For the sake
of argument, let's say the branch I'm working on in the last paragraph
is =foo=. Well, if I tell Magit (from my laptop) to create a spinoff
branch named =bar= of my repository, it will
 1. Find the last commit common to =foo= and its upstream,
 2. Take all of the commits to =foo= after that commit and move them
    into the new =bar= branch, and
 3. Revert =foo= to the upstream commit.
Simple as that! Suddenly I can pull changes made at the office to my
local repo, push the commits pertaining to my current project to the
remote, and have several more flexible ways to address any merge
conflicts locally (and when I see fit not when I want to push
changes).
* Startup
Enable debugging while loading configuration files. This is disabled
later in the config file.

#+BEGIN_SRC emacs-lisp
  (setq debug-on-error t)
  (setq debug-on-quit t)
#+END_SRC

Now start tracking how long loading config files takes.

#+BEGIN_SRC emacs-lisp
  ;;; Use the following time format in format-time-string calls when
  ;;; debugging/benchmarking the init file.
  (setq drmrd/debug/timeformat "%I:%M%p (%S.%3Ns)")

  (message (concat "Loading Emacs configuration started at "
                   (format-time-string drmrd/debug/timeformat)))
#+END_SRC
** Benchmark Initialization                                       :DISABLED:
The following code, based on [[https://www.reddit.com/r/emacs/comments/2094tl/how_can_i_improve_emacs_performance/cg0ydzc][this reddit comment from wadcann]] makes it
so that messages are posted to the *Messages* buffer with timestamps
as Emacs loads, providing a way to analyze which packages, functions,
etc. are eating up the most startup time.
#+BEGIN_SRC emacs-lisp :tangle no
  ;;; Timestamps in *Messages* at startup
  (defun drmrd/debug/message-time-prefix ()
    "Returns the string \"[TIME] \" where `TIME' is the current
    time, in the format specified by `drmrd/debug/timeformat'. This
    will be used to insert timestamps before each command in the
    `*Messages*' buffer during (and after) startup."
    (let* ((nowtime (current-time))
           (now-ms (nth 2 nowtime)))
          (concat "["
                  (format-time-string drmrd/debug/timeformat)
                  "] ")))

  (defadvice message (before test-symbol activate)
    (if (not (string-equal (ad-get-arg 0) "%s%s"))
        (let ((deactivate-mark nil)
              (inhibit-read-only t))
          (with-current-buffer "*Messages*"
            (goto-char (point-max))
            (if (not (bolp))
                (newline))
            (insert (drmrd/debug/message-time-prefix))))))
#+END_SRC
* Load Package Manager and Package-Loader
** Configure =package=
The following code loads =package= for package management, sets the
default package repositories, and then initializes =package=.

Load Package, load all default packages, and link to all standard
package repositories.

We first ensure that the Package package for package management
(that's a mouthful!) has been loaded. Then we call package-initialize,
which loads all packages specified in the variable
package-load-list. After loading the default packages, we redefine the
package-archives list to include ELPA, GNU, MELPA, and Marmalade.

*Update:* I now do all of the above in the .emacs (or Preferences.el
 in the case of Aquamacs) file instead, so that I can initialize
 =package= before calling =org= for the first time. This ensures that
 the up-to-date version of =org= from ELPA is used instead of the
 built-in version.
** Bootstrap =use-package=
Next, we ensure that =use-package= is installed on our system.

It's mentioned in the [[https://github.com/jwiegley/use-package][use-package README on GitHub]] that it's no longer
necessary (as of v2.0) to load =use-package= at runtime. It suggests
putting the following code at the start of our config, which uses
=eval-when-compile= to load =use-package= only when necessary, further
reducing load time.

#+SRC_NAME use-package--init
#+BEGIN_SRC emacs-lisp
  ;; Install `use-package' (if not already done)
  (unless (package-installed-p 'use-package)
    (package-refresh-contents)
    (package-install 'use-package))

  ;; Lazily load use-package, and also load the diminish and bind-key
  ;; packages for hiding messages from active modes in the modeline with
  ;; :diminish and easily setting keybindings with :bind.
  (eval-when-compile
    (require 'use-package))
  (require 'diminish)
  (require 'bind-key)
#+END_SRC

We also ensure that all packages loaded through =use-package= are
automatically installed on the current system.

#+SRC_NAME use-package--config
#+BEGIN_SRC emacs-lisp
  ;; Install packages from a repo that we attempt to load but are not
  ;; present on the system.
  (setq use-package-always-ensure t)
#+END_SRC
* Appearance & UI                                             :Appearance:UI:
** Miscellany
*** Set Default Font(s)                                             :Fonts:
Naturally, fonts are quite OS and machine-specific, so this portion of the
configuration will probably grow a bit with time. For now, the following
configuration is appropriate. On Mac OS X, the Vera Sans font family is used,
while on Linux we employ DejaVu Sans Mono.
#+BEGIN_SRC emacs-lisp
  (set-face-attribute 'default nil
                      :font (case system-type
                                  ('darwin "-apple-bitstream vera sans
                                            mono-medium-r-normal--0-0-0-0-m-0-mac-roman")
                                  ('gnu/linux "DejaVu Sans Mono-10")))
#+END_SRC
*** Disable Cursor Blinking                                   :CursorBlink:
The enemy of civil society. I disable cursor blinking not only
because I find it obnoxious and distracting, but because it's *the
right thing to do*.
#+BEGIN_SRC emacs-lisp
  (blink-cursor-mode (- (*) (*) (*)))
#+END_SRC
** Mode Line                                                       :ModeLine:
*** Show column numbers                                       :ColumnNumbers:
#+SRC_NAME enable_column-number-mode
#+BEGIN_SRC emacs-lisp
  (column-number-mode 1)
#+END_SRC
*** Show the current time                                            :Time:
#+BEGIN_SRC emacs-lisp
  (display-time)
#+END_SRC
*** nyan-mode                                                     :nyan_mode:
Display current location in buffer as a magical rainbow behind a poptart cat
#+SRC_NAME nyan-mode-setup
#+BEGIN_SRC emacs-lisp
  (use-package nyan-mode :ensure t)
#+END_SRC
*** TODO smart-mode-line (sml)                          :sml:smartmodeline:
Extend and customize the modeline. Use =sml/customize= (or go to the customize
group) to tweak variables that affect the modeline's theming, what is displayed,
and how it's displayed.

Really a fantastic package. My only issue currently is that it's messing with
the theme I'm using. I should read the docs more to see if I'm loading things in
the wrong order or something.

Need to tweak this to avoid errors.
#+SRC_NAME smart-mode-line_setup
#+BEGIN_SRC emacs-lisp :tangle no
  (use-package smart-mode-line
    :init
      (setq sml/no-confirm-load-theme t)
    :config
      (sml/setup))
#+END_SRC
*** Hide/tweak minor mode lighters :diminish:delight:MinorModeLighters:
**** delight
A package for removing/modifying major and minor mode lighters (text indicators)
appearing in the mode-line.

#+SRC_NAME load_delight
#+BEGIN_SRC emacs-lisp
  (use-package delight)
#+END_SRC
**** Create minor mode lighter specifications            :CustomVariables:
#+SRC_NAME set_drmrd/adjusted-mode-lighter-specs
#+BEGIN_SRC emacs-lisp
  (defcustom drmrd/adjusted-mode-lighter-specs
    '((ws-butler-mode nil "ws-butler")
      (fixmee-mode nil "fixmee")
      (button-lock-mode nil "button-lock")
      (yas-minor-mode nil "yasnippet")
      (projectile-mode nil "projectile")
      (reftex-mode nil "reftex")
      (guide-key-mode nil "guide-key")
      (visual-line-mode)
      (git-gutter-mode nil "git-gutter")
      (outline-minor-mode nil "outline")
      (undo-tree-mode nil "undo-tree"))
    "A list of minor modes to hidden in the mode line whenever they're loaded."
      :tag "Adjusted Minor Mode Lighters in the Mode Line"
      :type '(repeat sexp)
      :group 'emacs)
#+END_SRC

#+SRC_NAME configure_minor_modes_with_delight :tangle yes
#+BEGIN_SRC emacs-lisp
  (delight drmrd/adjusted-mode-lighter-specs)
#+END_SRC
**** Create function for loading other delighted modes         :Functions:
The following function can be used to load another mode and delight it all at
the same time.

#+SRC_NAME defun_drmrd/load-diminished-minor-mode
#+BEGIN_SRC emacs-lisp :tangle yes
  (defun drmrd/load-diminished-mode(mode value library)
    "Load mode MODE and use `delight' to format its lighter with
  specification (MODE VALUE LIBRARY).

  This function is intended for use in hooks, but works equally
  well when evaluated manually."
    (funcall mode)
    (diminish mode value library))
#+END_SRC
** Theming                                                          :Themes:
*** (DISABLED) Load a Color Theme
#+BEGIN_SRC emacs-lisp :tangle no
  (load-theme 'dracula t)
#+END_SRC
**** (Obsolete) Using color-theme to load a theme
(I've kept these notes here for reference, in case I'm stranded on a
desert island with no internet and an old copy of Emacs. They are
irrelevant in versions beyond v24.)

Color-Theme Mode is Emacs's standard theming engine for customizing
faces throughout the UI and editor. We first load the package and
initialize it.

#+BEGIN_SRC emacs-lisp :tangle no
  (require 'color-theme)
  (color-theme-initialize)
#+END_SRC

Now we choose a color theme to load. I've commented out several other
nice candidates, and other themes showing potential should also be
added here.

#+BEGIN_SRC emacs-lisp :tangle no
  ;(color-theme-bharadwaj-slate)
  (color-theme-charcoal-black)
  ;(color-theme-classic)
  ;(color-theme-deep-blue )
  ;(color-theme-ld-dark)
  ;(color-theme-midnight)
  ;(color-theme-pok-wog)
  ;(color-theme-resolve)
  ;(color-theme-shaman)
  ;(color-theme-subtle-hacker)
#+END_SRC
*** Have load-theme unload other color themes before loading new ones
I have no idea why this isn't the default behavior. See
[[http://emacs.stackexchange.com/a/3114/8643][this post]] for a good overview of color-themes, disabling theme when
loading new ones, and the pros and cons of using color-theme vs
Emacs24's built-in custom themes.
#+BEGIN_SRC emacs-lisp
  (defadvice load-theme (before theme-dont-propagate activate)
                        (mapc #'disable-theme custom-enabled-themes))
#+END_SRC
** Display Line Numbers                                 :nlinum:LineNumbers:
Ah yes, the somewhat notorious problem of displaying line numbers in Emacs in a
way that doesn't break/get terribly affected by different modes and font locking
schemes. Most recently I've been using nlinum mode for this purpose, but I can't
seem to use it while loading multiple frames. This is only an issue on my
laptop, not at the office, so I'm now testing to see if it's some kind of timing
issue.
#+BEGIN_SRC emacs-lisp
  (defun initialize-nlinum (&optional frame)
         (require 'nlinum)
         (add-hook 'prog-mode-hook 'nlinum-mode))

  (add-hook 'window-setup-hook 'initialize-nlinum)
  (defadvice make-frame (around toggle-nlinum-mode compile activate)
             (nlinum-mode -1) ad-do-it (nlinum-mode 1))
#+END_SRC
** Highlight the Current Line                      :hlline:LineHighlighting:
Highlights the current line in every buffer by default
#+BEGIN_SRC emacs-lisp :tangle yes
  (global-hl-line-mode 1); Highlight current line in buffer
#+END_SRC
** Set Default Frame Size                                        :FrameSize:
#+SRCNAME set_default_frame_size
#+BEGIN_SRC emacs-lisp
  (add-to-list 'default-frame-alist '(width . 86))
#+END_SRC
** git-gutter-fringe                     :gitgutterfringe:Git:UI:Diff:Fringe:
Displays a minimalist indicator in the fringe (side margin) of changes made to
the current file since the last commit. After seeing this in Sublime Text and
IntelliJ IDEA I'm hooked. It's amazingly useful without getting in the way.
#+SRC_NAME enable_git-gutter-fringe
#+BEGIN_SRC emacs-lisp
  (use-package git-gutter-fringe
      ;; Move fringe to the right margin
      :init (setq git-gutter-fr:side 'right-fringe)
      :config (global-git-gutter-mode t)
      :ensure t
      :diminish t)
#+END_SRC

* Navigation                                                     :Navigation:
** Ido Mode (Better, Interactive find-file Command) :ido:Completion:FileNavigation:
Enable Ido Mode for a much improved buffer and file switching/finding
experience. Configuring Ido Mode, based on the settings in [[http://xgarrido.github.io/emacs-starter-kit/starter-kit-ido.html][xgarrido's
Emacs Starter Kit]].
*** Enable Ido Mode
#+srcname: enable-ido-mode
#+begin_src emacs-lisp
  (ido-mode t)
#+end_src
*** Basic Configuration
Next, we change some basic settings to make our lives easier. The
following table describes each setting. Note that, for Boolean
variables, the Description column shows the behavior if non-nil, with
the behavior being the opposite if nil (unless otherwise specified).

|-----------------------+----------------------------------+----------------------------|
| Setting (ido-[...])   | Description                      | Possible Values            |
|-----------------------+----------------------------------+----------------------------|
| everywhere            | Enable Ido Everywhere            | Boolean                    |
| enable-prefix         | Match input only if prefix       | Boolean                    |
| enable-flex-matching  | If no string match, match        | Boolean                    |
|                       | filenames containing input chars |                            |
| auto-merge-work       | Auto switch to merged work       | Integer N (disable if < 0) |
| -directories-length   | directories after N typed chars  |                            |
| use-filename-at-point | Use filename at point?           | Boolean                    |
| max-prospects         | Max number of results to display | Integer N >= 0             |
|                       | (infinite if set to 0)           |                            |
| create-new-buffer     | Create a new buffer if no buffer | 'always                    |
|                       | matches substring?               | 'prompt                    |
|                       |                                  | 'never                     |
| use-virtual-buffers   |                                  | Boolean                    |
|                       |                                  |                            |
| handle-duplicate      | ??? (...obsolete?)               | ???                        |
| -virtual-buffers      |                                  |                            |
| default-buffer-method | Determines where/how the         | selected-window            |
|                       | selected buffer is opened        | other-window               |
|                       |                                  | display                    |
|                       |                                  | other-frame                |
|                       |                                  | maybe-frame                |
|                       |                                  | raise-frame                |
|                       |                                  | already shown              |
| default-file-method   | Determines where/how the         | Same as                    |
|                       | selected file is opened          | default-buffer-method      |
|-----------------------+----------------------------------+----------------------------|

|------------------------------------------------------------------------------------------|
| Notes                                                                                    |
|------------------------------------------------------------------------------------------|
| Several options mention =virtual buffers=, which are ido-mode's way of pretending        |
| recently-closed buffers are open. So, for instance, if you set =ido-use-virtual-buffers= |
| to =t=, ido-mode will keep a list of recently-closed buffers at the bottom of the buffer |
| list (displayed in the font-face =ido-virtual=), enabling you to, e.g., switch to        |
| recently-closed buffers after you exit and re-open Emacs.                                |
|------------------------------------------------------------------------------------------|

#+SRCNAME: ido-mode-basic-config
#+BEGIN_SRC emacs-lisp
  (setq ido-everywhere            t
        ido-enable-prefix         nil
        ido-enable-flex-matching  t
        ido-auto-merge-work-directories-length nil
        ido-use-filename-at-point t
        ido-max-prospects         10
        ido-create-new-buffer     'always
        ;; ido-use-virtual-buffers   t
        ;; ido-handle-duplicate-virtual-buffers 2
        ido-default-buffer-method 'selected-window
        ido-default-file-method   'selected-window)
#+END_SRC

*** Custom Keybindings
Since we will configure Ido Mode to [[*Order%20Results%20Vertically][order results vertically]] below,
rather than horizontally, we will also make the up and down arrow keys
move up and down the list of results for easy browsing.

#+SRCNAME: ido-mode-custom-keybindings
#+BEGIN_SRC emacs-lisp
  (defun ido-my-keys ()
    (define-key ido-completion-map (kbd "<up>")   'ido-prev-match)
    (define-key ido-completion-map (kbd "<down>") 'ido-next-match))

  (add-hook 'ido-setup-hook 'ido-my-keys)
#+END_SRC

*** Order File Extensions
Set the order in which Ido displays files based on their extensions.
#+srcname: ido-mode-extension-order
#+BEGIN_SRC emacs-lisp
  (setq ido-file-extensions-order     '(".tex" ".org" ".log" ".cc"
                                        ".h" ".sh" ".el" ".png"))
#+END_SRC

*** Set Ignored File Extensions and Buffers
The following settings tell Ido Mode to ignore various types of files
and buffers that we never actually look up/attempt to switch to.

#+SRCNAME: ido-mode-ignored-extensions-and-buffers
#+BEGIN_SRC emacs-lisp
  (setq completion-ignored-extensions '(".o" ".elc" "~" ".bin" ".bak"
                                        ".obj" ".map" ".a" ".so"
                                        ".mod" ".aux" ".out" ".pyg"
                                        ".bbl" ".blg" ".idx" ".ilg"
                                        ".ind" ".rel" ".synctex.gz"
                                        "_flymake.bcf" "_flymake.dvi"
                                        "_flymake.run.xml"
                                        "_flymake.tex" ".fdb_latexmk"
                                        ".fls" ".DS_Store"))
  (setq ido-ignore-extensions t)
  (setq ido-ignore-buffers (list (rx (or (and bos  " ")
                                         (and bos
                                              (or "*Completions*"
                                                  "*Shell Command Output*"
                                                  "*vc-diff*")
                                              eos)))))
#+END_SRC
**** TODO Create a new function/keybinding that lists EVERYTHING in the directory
This would be nice for, e.g., hacking intermediate TeX files on the
rare occasions when that's useful/necessary.

*** Allow Spaces in ido-find-file
By default, pressing [Space] does nothing when using ido-find-file,
which makes it difficult to search with several words that you know
occur in the file name. This snippet changes this behavior to be more
intuitive.

#+SRCNAME: ido-mode-enable-spaces
#+BEGIN_SRC emacs-lisp
  (add-hook 'ido-make-file-list-hook
            (lambda ()
              (define-key ido-file-dir-completion-map (kbd "SPC") 'self-insert-command)))
#+END_SRC

*** Order Results Vertically & Change Ido Result Formatting
By default Ido Mode displays results in a multi-line horizontal list,
which is, frankly, difficult to read at times. This code makes Ido
list results in a vertical list instead.

#+SRCNAME: ido-mode-list-results-vertically
#+BEGIN_SRC emacs-lisp
  (setq ido-decorations (quote ("\n-> "   ""      ; The "brackets" around the
                                                  ; entire prospect list
                                "\n "             ; The prospect separator
                                "\n ..."          ; String inserted at end of a
                                                  ; truncated list of prospects
                                "["       "]"     ; Brackets around the common
                                                  ; match string (that can be
                                                  ; completed using [Tab])
                                " [No match]"     ; The string to display when
                                                  ; there are no matches
                                " [Matched]"      ; The string to display when
                                                  ; there is a unique match (and
                                                  ; faces are not being used)
                                " [Not readable]" ; The string to display when
                                                  ; the current directory is not
                                                  ; readable
                                " [Too big]"      ; The string to display when
                                                  ; the current directory
                                                  ; is > ido-max-directory-size
                                " [Confirm]"      ; The string to display when
                                                  ; creating a new file buffer
                                ; Absent 12th & 13th strings:
                                ; Brackets around the sole remaining completion,
                                ; if they should differ from 5 and 6.
                        )))
  (defun ido-disable-line-truncation () (set (make-local-variable 'truncate-lines) nil))
  (add-hook 'ido-minibuffer-setup-hook 'ido-disable-line-truncation)
#+END_SRC

** SMEX Mode (Ido for M-x)               :smex:Completion:Mx:FileNavigation:
Replace the usual M-x keybinding with an equivalent that also list all
completions of the partial command name you've typed in much the same
way Ido Mode does for buffers and files.

#+SRCNAME: configure-smex
#+BEGIN_SRC emacs-lisp
  (use-package smex
    :bind
      ("M-x" . smex)
      ("M-X" . smex-major-mode-commands))
#+END_SRC

** Recentf (Track Recent Files, Load via C-x C-r)   :recentf:FileNavigation:
#+SRCNAME load-and-configure-recentf
#+BEGIN_SRC emacs-lisp
  (use-package recentf
    :init
      (setq recentf-max-menu-items 50)
    :config
      (recentf-mode 1)
      (add-to-list 'recentf-exclude "ido.last")
    :bind
      ("C-x C-r" . recentf-open-files))
#+END_SRC

** Bookmarks                            :bookmarks:Bookmarks:FileNavigation:
Bookmarks are supported by default in recent versions of Emacs, but
there are possible enhancement packages, notably =bookmarks+=, that we
should consider using.
*** Keybindings
All of the following keybindings are defaults.

|------------+-----------------------+---------------------------------|
| Keybinding | Command Name          | Description                     |
|------------+-----------------------+---------------------------------|
| C-x r m    | =bookmark-set=        | Create a new bookmark to the    |
|            |                       | current location in a file      |
|            |                       | buffer and prompt the user for  |
|            |                       | its name.                       |
|------------+-----------------------+---------------------------------|
| C-x r b    | =bookmark-jump=       | Prompt the user for the name of |
|            |                       | another bookmark and open it in |
|            |                       | this buffer.                    |
|------------+-----------------------+---------------------------------|
| C-x r l    | =bookmark-bmenu-list= | Display a list of existing      |
|            |                       | bookmarks in a buffer entitled  |
|            |                       | *Bookmark List*.                |
|------------+-----------------------+---------------------------------|

** TODO Dired+: Extensions to Dired               :diredplus:FileNavigation:
** ace-window: Easy Window Navigation with M-p :acewindow:WindowNavigation:Frames:Windows:
The ace-window package makes switching between more than two windows
much easier in Emacs. See the documentation for complete details, but
the ace-window command will be bound to M-p here.
#+BEGIN_SRC emacs-lisp
  (use-package ace-window
    :bind ("M-p" . ace-window)
    :bind ("M-P" . ace-window)) ; To use when M-p is overridden
#+END_SRC
*** TODO Find a way to use S-M-p to alternate between the two most recently used windows
This behavior doesn't seem to be cooked into ace-window by default,
but it would be a real time-saver and convenience. Bonus points if I
can come up with a way to also set the two windows to alternate
between by selecting window numbers in ace-window's numeric window
selection mode.

** helm                                                                :helm:
This package is impossible to categorize completely and deserves its own library
file. See [[*Helm][below]] for the main description.

* Global Settings
** Personal Information
*** Email Address
#+BEGIN_SRC emacs-lisp
  (setq user-mail-address "contact@drmrd.xyz")
#+END_SRC
*** Paradox GitHub Token
#+BEGIN_SRC emacs-lisp
  ;; Retrieve the Paradox Package Manager's GitHub Token
  ;;
  ;; Loads a file containing a single instruction, which sets the GitHub token for
  ;; Paradox.  Do not store that file in a public repo.
  (org-babel-load-file
      (expand-file-name "~/.emacs.d/secure/paradox-github-token.org"))
#+END_SRC
** Default Keybinding Replacements                              :Keybindings:
#+BEGIN_SRC emacs-lisp
  (global-set-key (kbd "M-/") 'hippie-expand)
  (global-set-key (kbd "M-z") 'zap-up-to-char)

  (setq select-enable-clipboard             t
        select-enable-primary               t
        save-interprogram-paste-before-kill t
        mouse-yank-at-point                 t)
#+END_SRC
** General Editing Settings
*** Fill Column Settings
#+SRC_NAME set-fill-column
#+BEGIN_SRC emacs-lisp :tangle yes
  ;;; Make fill-column default to 80 (instead of the usual 70)
  (setq-default fill-column 80)
#+END_SRC

#+SRC_NAME enable_fill_column_indicators
#+BEGIN_SRC emacs-lisp :tangle yes
  ;;; Display a vertical rule at the fill-column
  (use-package fill-column-indicator
      :config (turn-on-fci-mode))
#+END_SRC
** What to Display at Startup
Disable the welcome screen and instead display a welcome message as a
comment in the scratch buffer.
#+BEGIN_SRC emacs-lisp
    (setq inhibit-startup-screen t)   ; Disable Emacs's welcome screen
    (setq initial-scratch-message ";; Welcome to Emacs!\n")
#+END_SRC
** Change Where Customizations are Stored
By default, Emacs adds settings set via the customizations menu to the
end of the .emacs file.
#+SRCNAME set_customizations_file
#+BEGIN_SRC emacs-lisp
  (setq custom-file "~/.emacs.d/customizations.el")
  (load custom-file)
#+END_SRC
** Load Other Config Files
We now add several directories to the load-path. The directory
~/workspace/elisp is a git repository containing some older
configuration file, which I should probably just incorporate into this
file and/or other org files in .emacs.d. The second directory is
~/.emacs.d itself, which I thought was loaded by default but
apparently not in all Emacs versions (or at least not in Aquamacs it
seems).

#+srcname: custom-load-paths
#+begin_src emacs-lisp :tangle no
  (add-to-list 'load-path "~/.emacs.d/lib")
#+end_src

*** Update: Disabled in favor of org-babel-load-file calls
To avoid accidentally loading old tangled files (or other unwanted
behavior), we are no longer including ~/.emacs.d/lib in our load
path. Instead, libraries that we wish to load from here will be
explicitly tangled and loaded via =org-babel-load-file= in this config
file (and the files it loads).
** Load Third-Party Elisp not Managed by *Package*
#+BEGIN_SRC emacs-lisp
  (add-to-list 'load-path "~/elisp")
#+END_SRC
** Bind Settings Files to Registers
Bind init.org, .emacs.d/lib/latex.org, and Preferences.el to the
registers "e", "l", and "p" (resp.) so that they can be opened easily with
"C-x r j <register>".

#+SRCNAME set-config-registers
#+BEGIN_SRC emacs-lisp
  (set-register ?e '(file . "~/.emacs.d/init.org"))
  (set-register ?i '(file . "~/.emacs.d/.emacs"))
  (set-register ?l '(file . "~/.emacs.d/lib/latex.org"))
  (set-register ?o '(file . "~/.emacs.d/lib/org.org"))
  (set-register ?L '(file . "~/.emacs.d/lib/"))
  (set-register ?W '(file . "~/workspace/"))

  ;; Also set a register for Preferences.el if on a Mac
  (if (eq system-type 'darwin)
    (set-register ?p (cons 'file "~/Library/Preferences/Aquamacs Emacs/Preferences.el")))
#+END_SRC

*** DONE Determine how to evaluate this file without reloading Aquamacs
Invoke org-babel-load-file on init.org to retangle and reload this
file.

To modify and re-evaluate a single code block, use C-c C-c inside the block.
*** DONE Add registers for .emacs.d/lib/latex.org and Preferences.el
It might be worth also adding a register for Preferences.el for when I
want to evaluate this buffer without reloading emacs (although Babel
probably has an easier way to do that natively).
** Set the Default Directory
Make the default directory ~/workspace/ for easy access to LaTeX
projects.

#+BEGIN_SRC emacs-lisp
  (setq default-directory "~/workspace/")
#+END_SRC

** Set the Default Major Mode to Text Mode
Make Text Mode the default major mode, but disable the Auto-Fill Mode
hook.

#+BEGIN_SRC emacs-lisp
  (setq default-major-mode 'text-mode)
  (remove-hook 'text-mode-hook 'auto-fill-mode)
  (add-hook 'text-mode-hook 'kill-auto-fill-mode)
#+END_SRC

** Make Emacs insert a newline at the end of each file
I can't find a link at the moment, but requiring newlines at the end
of files prevents some kind of buggy behavior at times. I think I read
about this on StackExchange at some point.

#+BEGIN_SRC emacs-lisp
  (setq require-final-newline t)
#+END_SRC
** Backup Settings                                                 :Backups:
#+BEGIN_SRC emacs-lisp
  ; Store all backup files created by Emacs in the same directory
  (setq backup-directory-alist '(("." . "~/.backups_emacs")))

  ; Make Emacs create backups by copying files. If this leads to a
  ; performance hit, see the other available backup methods (or just
  ; comment out this line), as described in the documentation of the
  ; make-backup-files variable.
  (setq backup-by-copying t)


  (setq delete-old-versions t
        kept-new-versions   6
        kept-old-versions   2
        version-control     t) ; Use version numbers in backup file
                               ; names
#+END_SRC
** (DISABLED) Force Files to Open in Read Only Mode
This is a bit of an experiment to see if I like defaulting to this
behavior, but I'd rather have to actively switch to editing
dissertation files than accidentally make changes when I'm just
browsing. Uhoh...this might be a slippery slope towards using evil
mode, I think. As usual, if selecting from dired I can just use =v=
(bound by default to [[help:dired-view-file][dired-view-file]]. When loading from the
minibuffer, the easiest solution is just adding a function that sets
the buffer to read only to the [[help:find-file-hook][find-file-hook]].

#+SRC_NAME: force-read-only-buffers
#+BEGIN_SRC emacs-lisp :tangle no
  (add-hook 'find-file-hook (lambda () (setq buffer-read-only t)))
#+END_SRC

A better solution is to probably set buffer-read-only to true as a
file variable when needed.

*Edit:* This has been disabled, since, as I suspected, it breaks
 everything.
** Other Default Settings
#+BEGIN_SRC emacs-lisp
  (setq apropos-do-all t)   ; Make all apropos commands perform more
                            ; extensive searches

  ;; Make y and n suffice for answers to yes or no questions
  (fset 'yes-or-no-p 'y-or-n-p)
#+END_SRC
** Compilation Behavior                              :Keybindings:Compiling:
The following is brough to us by bpalmer and zigler on the
[[https://www.emacswiki.org/emacs/UsingMakefileFromParentDirectory][EmacsWiki]]. It adds a =get-nearest-compilation-file= function that
searches parent directories for a Makefile (or any file with name in
=compilation-filenames=) to use during compilation and binds the new
function to F5.
#+BEGIN_SRC emacs-lisp
  (setq compilation-filenames '("Makefile"))

  (defun get-nearest-compilation-file ()
    "Search for the compilation file traversing up the directory tree."
    (let ((dir default-directory)
          (parent-dir (file-name-directory (directory-file-name default-directory)))
          (nearest-compilation-file 'nil))
      (while (and (not (string= dir parent-dir))
                  (not nearest-compilation-file))
        (dolist (filename compilation-filenames)
          (setq file-path (concat dir filename))
          (when (file-readable-p file-path)
            (setq nearest-compilation-file file-path)))
        (setq dir parent-dir
              parent-dir (file-name-directory (directory-file-name parent-dir))))
      nearest-compilation-file))

  ;; bind compiling with get-nearest-compilation-file to f5
  (global-set-key [f5] (lambda () (interactive) (compile (format
             "make -f %s" (get-nearest-compilation-file)))))
#+END_SRC
** Indentation & Whitespace Settings
This deserves its own section, since it is always the part of text
editors I tweak the most.
*** Default to indenting with spaces, four at a time
#+BEGIN_SRC emacs-lisp
  ;; make return key also do indent, globally
  ; (electric-indent-mode 1)

  ;; Set tab width to 4
  (setq tab-stop-list (number-sequence 4 200 4))

  ;; Force emacs to only indent with spaces and never tabs
  (setq-default indent-tabs-mode nil)
#+END_SRC
*** [Tab] behavior
**** Set =tab-always=indent=: Make [Tab] try to indent or (if already indented) complete the thing-at-point
Change the =tab-always-indent= setting to "complete", which makes
[Tab] first try to indent the current line and then, iff it was
already indented, attempt to complete the thing at the current point.

The other options for this variable are =nil=, which makes [Tab]
indent the current line if at the left margin or in its indentation
and otherwise literally insert a TAB character, and =t=, which makes
[Tab] always indent.
#+BEGIN_SRC emacs-lisp
  (setq-default tab-always-indent 'complete)
#+END_SRC emacs-lisp

**** Bind M-q to =indent-relative=
#+BEGIN_SRC emacs-lisp
  ;;
  ;  Makes M-q indent from cursor to the space prior to the next
  ;  non-whitespace character on the previous line.
  ;
  ;  Example: If the current buffer looks as follows (with the cursor denoted by *)...
  ;
  ;          sample text is entertaining to write
  ;          I completely agree* with you
  ;
  ;      Then the result of hitting M-q will be
  ;
  ;          sample text is entertaining to write
  ;          I completely agree          with you
  ;
  ;      with the cursor right before the "w" in "with".
  (global-set-key (kbd "M-q") 'indent-relative)
#+END_SRC
***** TODO Consider also setting [Tab] (or something) to (indent-relative-maybe).

* IDE Features                                      :IDE:Convenience:Editing:
** flycheck & friends: On-the-fly error checking & linting :Lint:ErrorChecking:flycheck:
#+SRC_NAME enable_global-flycheck-mode
#+BEGIN_SRC emacs-lisp
  ;;; Flycheck Mode (and friends)
  ;;;
  ;;;     Enable and configure `flycheck' for a powerful, customizable,
  ;;;     extensible, drop-in replacement for `flymake'.

  ;; Load flycheck
  (use-package flycheck
      :ensure t
      :init (global-flycheck-mode))
#+END_SRC

#+SRC_NAME enable_flycheck_extensions
#+BEGIN_SRC emacs-lisp
  ;; Change the color of the modeline based on flycheck's current status
  (use-package flycheck-color-mode-line
      :ensure t
      :config (add-hook 'flycheck-mode-hook 'flycheck-color-mode-line-mode))

  ;; Display a tooltip at the cursor position when on a flycheck error
  (use-package flycheck-pos-tip
      :ensure t
      :if window-system
      :config (add-hook 'flycheck-mode-hook 'flycheck-pos-tip-mode))

  ;; Replace `flycheck''s built-in modeline status indicators with cute, compact,
  ;; meaningful emoji and warning/error counts
  (use-package flycheck-status-emoji
      :ensure t
      :init (set-fontset-font t nil "Symbola")
      :config (add-hook 'flycheck-mode-hook 'flycheck-status-emoji-mode))

  ;; Support adding C/C++ libraries to `flycheck-clang-include-path' using
  ;; `pkg-config' and completion. This simplifies getting `flycheck' to recognize
  ;; appropriate libraries in a system-independent way.
  ;;
  ;; Note: This is not a minor mode. Call `flycheck-pkg-config' interactively to
  ;; lookup (with completion) the correct path to add to
  ;; `flycheck-clang-include-path' by library name.
  (use-package flycheck-pkg-config :ensure t)
#+END_SRC
** STARTED Projectile: PROJECT Interaction Library for Emacs :ProjectManagement:projectile:
** STARTED org-projectile: Manage TODOs associated with a projectile project :ProjectManagement:OrgProjectile:TaskManagement:
#+SRC_NAME: org-projectile-setup
#+BEGIN_SRC emacs-lisp
  (use-package org-projectile
    :bind (("C-c n p" . org-projectile:project-todo-completing-read))
    :config
      (progn (setq org-projectile:projects-file "/home/dan/org/projects.org")
             (setq org-agenda-files (append org-agenda-files (org-projectile:todo-files)))
             (add-to-list 'org-capture-templates (org-projectile:project-todo-entry "p")))
    :ensure t)
#+END_SRC

* Utility Functions                                               :Functions:
** drmrd/load-library
#+SRC_NAME: def_drmrd/load-library
#+BEGIN_SRC emacs-lisp
  (defcustom drmrd/lib-directory "~/.emacs.d/lib"
    "The root directory for libraries to be loaded by `drmrd'
    configuration files. This is used, for instance, for convenient loading of
    library files via `drmrd/load-library'."
    :type '(directory))

  (defun drmrd/load-library (name &optional directory)
    "Load the library `NAME' in the default library. Here `NAME' can be any
    file name or relative path to a file, but it should be relative to the default
    library directory specified in the `drmrd/lib-directory' variable, unless an
    alternative directory `DIRECTORY' is given as a second argument. This function
    can not be called interactively."
    (org-babel-load-file (expand-file-name name (or directory
                                                    drmrd/lib-directory))))
#+END_SRC
** insert-to-last-eol
#+BEGIN_SRC emacs-lisp
  (defun get-beginning-of-line-position (&optional arg)
    "Return the position of the beginning of the current line as
  displayed. (If there's an image in the line containing newlines, the
  same rules apply for this function as for `move-beginning-of-line'.)

  If an argument ARG is provided, return the position at the beginning
  of the (ARG - 1)-th line after (forward from) the current one. If ARG
  refers to a line before the first (respectively, after the last),
  return the position at the beginning of the first (respectively, last)
  line in this buffer."
    ;; It doesn't mention this in its docstring (like most point
    ;; manipulation functions), but `move-beginning-of-line' returns the
    ;; point it moves to after executing. So we just have to prevent it
    ;; from actually affecting the buffer position.
    (save-excursion (move-beginning-of-line arg)))

  (defun get-end-of-line-position (&optional arg)
    "Return the position of the end of the current line as
  displayed. (If there's an image in the line containing newlines,
  the same rules apply for this function as for
  `move-end-of-line'.)

  If an argument ARG is provided, return the position at the end of
  the (ARG - 1)-th line after (forward from) the current one. If
  ARG refers to a line before the first (respectively, after the
  last), return the position at the end of the first (respectively,
  last) line in this buffer."
    ;; It doesn't mention this in its docstring (like most point
    ;; manipulation functions), but `move-end-of-line' returns the point
    ;; it moves to after executing. So we just have to prevent it from
    ;; actually affecting the buffer position.
    (save-excursion (move-end-of-line arg)))

  (defun get-line-length (&optional arg)
    "Return the length of the current line as displayed (excluding
  invisible text, for instance). (If there's an image in the line
  containing newlines, the same rules apply for this function as for
  the `move-beginning-of-line' and `move-end-of-line' commands.)

  If an argument ARG is provided, return the length of the (ARG - 1)-th
  line after (forward from) the current one. If ARG refers to a line
  before the first (respectively, after the last), return the length of
  the first (respectively, last) line in this buffer."
    (- (line-end-position arg)
       (line-beginning-position arg)))

  ;; TODO: These are already defined by `line-beginning-position' and
  ;; `line-end-position'. Use `defalias' and these commands instead to
  ;; define the above functions. ...wasn't aware of these functions when
  ;; I first wrote these...

  ;; TODO: Consider prompting for input characters/strings in the next function
  (defun insert-to-previous-eol (&optional input)
    "Repeatedly insert the character before the point until in the
  column where the previous line ends. An error is thrown if the
  point is at the beginning of a line or if it is in the first line
  of the buffer."
    (interactive)
    ;; Throw an error if no `CHAR' is provided and the point is at
    ;; the beginning of a line.
    (when (= (line-beginning-position) (point))
      ;; FIXME: Determine if there's a better way to break the error
      ;;        string onto multiple lines that still looks
      ;;        stylistically correct.
      (error (concat "Error: No argument provided and point is at the "
                     "beginning of a line.")))
    ;; Also throw an error if the point is on the first line.
    (when (= (get-beginning-of-line-position 0)
             (get-beginning-of-line-position 1))
      (error (concat "Error: The point is on the first line of the "
                     "current buffer.")))
    (insert-char (char-before)
                 (- (get-line-length 0)
                    (- (point) (get-beginning-of-line-position 1)))))
#+END_SRC
** copy-regex: Copy Regular Expression without Doubling Backslashes
Yank text into the minibuffer without backslashes being doubled. This
is especially useful when working with regular expressions.

#+BEGIN_SRC emacs-lisp
  (defun copy-regex ()
    "Copy current RE into the kill ring without quotes and single
  backslashes for later insertion. This can be thought of as a drop-in
  replacement for `reb-copy' when you wish to yank the resulting copied
  regular expression from the kill ring into a minibuffer (as opposed to
  into elisp code somewhere."
    (interactive)
    (reb-update-regexp)
    (let* ((re (with-output-to-string (print (reb-target-binding reb-regexp))))
           (str (substring re 2 (- (length re) 2))))
      (with-temp-buffer (insert str)
                        (goto-char (point-min))
                        (while (search-forward "\\\\" nil t)
                          (replace-match "\\" nil t))
                        (kill-new (buffer-substring (point-min) (point-max))))
      (message "Regexp copied to kill-ring")))
#+END_SRC
** nolinums: Disable Line Numbers
Use (add-hook 'foo-mode-hook 'nolinums) to disable line numbering in
foo-mode
#+BEGIN_SRC emacs-lisp
  (defun nolinums ()
         (global-linum-mode 0)
         (global-nlinum-mode 0))
#+END_SRC
*** TODO Update this to not kill global modes
This is a very old function that should be updated to just kill linum
and nlinum modes in a particular mode, not globally.
** kill-auto-fill-mode: Disable auto-fill-mode (use as a hook)
#+BEGIN_SRC emacs-lisp
  (defun kill-auto-fill-mode ()
         "Disables auto-fill-mode when used as a hook"
         (auto-fill-mode -1)
         ; Remove the auto-detect-wrap function from the
         ; text-mode-hook if on Mac OS X (in case you're running
         ; Aquamacs).
         (if (eq system-type 'darwin)
             (remove-hook 'text-mode-hook 'auto-detect-wrap)))
#+END_SRC
** kill-aquamacs-autoface-mode: Disable aquamacs-autoface-mode (use as a hook)
#+BEGIN_SRC emacs-lisp
  (defun kill-aquamacs-autoface-mode ()
    "Disables Aquamacs's built-in `aquamacs-autoface-mode' when used as a hook."
    (if (eq system-type 'darwin)
        (progn (aquamacs-autoface-mode -1)
               (message "Aquamacs Autoface Mode disabled"))))
#+END_SRC
** org-babel-reload-file: org-babel-load-file but defaulting to the current file
#+BEGIN_SRC emacs-lisp
  (defun org-babel-reload-file (FILE &optional COMPILE)
    "Tangle and load a specified file, with the current buffer's file as
    default.

    Tangle the Emacs Lisp source code in the indicated Org-mode file
    FILE or the file corresponding to the active buffer if FILE is nil
    and the current buffer corresponds to an existing file. This works
    in precisely the same way as `org-babel-load-file'--calling
    `org-babel-tangle' on FILE and then `load-file' on the output elisp
    file--with the only difference being that this function defaults to
    the current file if no argument is provided."
    (interactive (let* ((buffer (buffer-file-name (current-buffer)))
                         prompt)
                       (setq prompt (format "File to load%s: "
                                            (if buffer
                                                (format " [Default: %s]" buffer))))
                       (list (read-file-name prompt nil (if buffer buffer)))))
    (org-babel-load-file FILE COMPILE))
#+END_SRC

*** DONE Finish implementing this function
CLOSED: [2015-12-05 Sat 12:54]
*** DONE Make the interactive prompt string say "default: [current buffer name here]"
CLOSED: [2015-12-05 Sat 12:55]

** string-length: Get the length of a string you input in a buffer (or have selected)
The built-in function [[help:string-width][string-width]] is made for exactly this purpose,
but it's not interactive (and, hence, can't be called for this
purpose). So this is just a wrapper function.
#+BEGIN_SRC emacs-lisp
  (defun string-length (string)
    "Get the length of a string input in the minibuffer."
    (interactive "^sString: ")
    (message (number-to-string (string-width string))))
#+END_SRC
** day-ordinal: Add ordinals to the current day of the month and a new format specifier %o
Provide support for displaying the current day's ordinal in
format-time-string calls without overriding anything.

#+BEGIN_SRC emacs-lisp
  (defun ordinal (n)
    "Special day of month format."
    (format
     (concat
      "%d"
      (if (memq n '(11 12 13)) "th"
        (let ((last-digit (% n 10)))
          (case last-digit
            (1 "st")
            (2 "nd")
            (3 "rd")
            (otherwise "th"))))) n))

  (defadvice format-time-string (before ordinal activate)
    "Add ordinal to %d."
    (let ((day (nth 3 (decode-time (or time (current-time))))))
      (setq format-string
        (replace-regexp-in-string "%o"
                      (ordinal day)
                      format-string))))
#+END_SRC
** today-is: Get today's date
#+BEGIN_SRC emacs-lisp
  (defun today-is ()
    "Displays the current date."
    (interactive)
    (message (format-time-string "Today is %A, %B %o, %Y")))
#+END_SRC
** insert-date, insert-time, and insert-date-and-time
These functions wear their hearts on their sleeves...not much more to
say about them.
#+SRC_NAME def_insert-date-and-time
#+BEGIN_SRC emacs-lisp
  ;;; Insert the date, time, or both at the current point
  (defun insert-date-and-time (&optional format-string)
    "Interactively insert the current date and time into the buffer at
  the point. The optional `format-string' argument accepts the same
  format as `format-time-string', and it defaults to '%F at %r', which
  creates dates and times such as '2016-07-04 at 06:49:17 PM'."
    (interactive)
    ;; Note the default format is equivalent to "%Y-%m-%d at %I:%M:%S %p"
    (insert (format-time-string (or format-string "%F at %r"))))

  (defun insert-date (&optional format-string)
    "Interactively insert the current date into the buffer at the
  point. The optional `format-string' argument accepts the same format
  as `format-time-string', and it defaults to '%F', which creates dates
  such as '2016-07-04'."
    (interactive)
    (insert-date-and-time (or format-string "%F")))

  (defun insert-time (&optional format-string)
    "Interactively insert the current time into the buffer at the
  point. The optional `format-string' argument accepts the same format
  as `format-time-string', and it defaults to '%r', which creates times
  such as '12:27:52 AM'."
    (interactive)
    (insert-date-and-time (or format-string "%r")))
#+END_SRC
** insert-random-UUID
#+NAME: insert-random-uuid
#+BEGIN_SRC emacs-lisp
    (defun insert-random-uuid ()
           "Inserts a UUID into the buffer at the current point. The UUID is
           generated using Linux's built-in uuidgen command."
           (interactive)
           (shell-command "uuidgen" t))
#+END_SRC
*** TODO Throw an error if not on Linux
* Packages                                                         :Packages:
The following list comprises all of the packages that (a) are loaded by default
in most major modes and (b) don't fit elsewhere in this configuration (yet).
** fixmee                                :fixmee:TaskManagement:Navigation:
A package for displaying and navigating TODOs, FIXMEs, etc. throughout a
project. Works great with =projectile=, too! Use the =C-x f= keybinding to load
a =projectile + fixmee= [[hydra]].

Tags are case-insensitive except for XXX, and priority (used in
priority-based navigation) is increased by adding more of the last
letter to the end of a tag. (For example FIXMEEEE has higher priority
than FIXME.)

Note that
#+BEGIN_SRC emacs-lisp :tangle yes
  (use-package fixmee
    :init
      (require 'button-lock)
    :config
      (global-fixmee-mode 1))
#+END_SRC
*** TODO Come up with a good replacement for the fixmee-goto-next-by-position keybinding
This is M-p by default, but that is currently being used by ace-window.
** flyspell-lazy                                :flyspelllazy:SpellChecking:
Load the third-party flyspell-lazy.elc script, which improves flyspell's
responsiveness by forcing it to only check spelling when Emacs has been idle for
a little while (as opposed to damn near constantly).

#+BEGIN_SRC emacs-lisp
  (require 'flyspell-lazy)
  (flyspell-lazy-mode 1)
#+END_SRC

*** NOTE: Flyspell must be loaded AFTER this code executes
Right now this isn't a problem, since flyspell is loaded via major mode hooks
(see the ./lib/latex.org config file for an example), but should we decide to
use it globally this code might need to be moved.
** gnutls                                                    :gnutls:TLS:SSL:
TLS and SSL support in Emacs.

By default, GnuTLS accepts primes of bit length at least 256 in key
exchanges. We beef this number up to add a bit more
security/protection from man-in-the-middle attacks.
#+SRC_NAME set_gnutls-min-prime-bits
#+BEGIN_SRC emacs-lisp
  ;(setq gnutls-min-prime-bits 4096)
  ;(setq gnutls-min-prime-bits 2048)
  (setq gnutls-min-prime-bits 1024)
#+END_SRC

To aid with debugging errors, I also modify the gnutls-log-level variable
globally. This controls how much debugging information is printed to the
=*Messages*= buffer when GnuTLS encounters an error. The default is 0, which
means show as little debugging information in the =*Messages*= buffer as
possible, and the other values from 1 through 5 follow the GnuTLS logging
conventions outlined in [[http://gnutls.org/documentation.html][its documentation]].

I find a good default for this value is either 1 or 2, the latter of which
includes both the "important messages" you get by setting it to 1 along with
more verbose "debugging data", with which you should be able to diagnose most
problems encountered between GnuTLS and Emacs.
#+SRC_NAME set_gnutls-log-level
#+BEGIN_SRC emacs-lisp
  (setq gnutls-log-level 1)
#+END_SRC
** hydra                                       :hydra:Keybindings:Libraries:
Groups of keybindings/registers on steroids

#+SRC_NAME: load-hydra-config
#+BEGIN_SRC emacs-lisp :tangle yes
  ;;; Load and configure `hydra'
  (use-package hydra
               :ensure
               :config
               (org-babel-load-file (expand-file-name "~/.emacs.d/lib/hydra.org")))
#+END_SRC
** keyfreq                                              :keyfreq:Keybindings:
A package for logging usage of keybindings. Use =keyfreq-show= to display the
current usage counts.

#+SRC_NAME enable_keyfreq
#+BEGIN_SRC emacs-lisp
  (use-package keyfreq
      :config (keyfreq-mode 1)
              (keyfreq-autosave-mode 1))
#+END_SRC
** paradox                                                  :paradox:PkgMgmt:
An updated package manager with better support for GitHub metadata. See the
documentation. Run it by calling M-x paradox-list-packages.  Note that the
Github token provided to paradox for Github integration is set in an [[*Paradox%20Github%20Token][earlier
section]].
#+BEGIN_SRC emacs-lisp
  (setq paradox-execute-asynchronously nil)
#+END_SRC
** pomodoro                           :pomodoro:Productivity:TaskManagement:
The *pomodoro.el* script adds pomodoro technique indicators to the
modeline. Enable the minor mode by invoking the `pomodoro'
command. Refer to the function's documentation for more info.

#+SRC_NAME pomodoro
#+BEGIN_SRC emacs-lisp
  (use-package pomodoro
    :config
      (setq pomodoro-raise-frame nil))
#+END_SRC

** Popwin (Popup Windows at Bottom of Screen)  :popwin:PopupWindows:UI:
#+BEGIN_SRC emacs-lisp
  (use-package popwin
    :config (popwin-mode))
#+END_SRC
** re-builder                                               :rebuilder:RegEx:
A regular expressions building helper for Emacs.

The Re-Builder (REgular expression BUILDER) package aids in
constructing regular expressions by highlighting all matches of the
current expression in the document, including different colors for
different capture groups and other amenities. It supports several
different styles of regular expressions (see the documentation), but
has been configured here to use the one that's probably the most
natural to me (and involves the fewest number of excess backslashes).

#+SRCNAME enable-re-builder
#+BEGIN_SRC emacs-lisp
  (use-package re-builder
      :init (setq reb-re-syntax 'string))
#+END_SRC
** re-builder+                                         :rebuilderplus:RegEx:
Upgrades to [[re-builder]] functionality, including =reb+-query-replace-regexp=,
which takes what's currently in a =re-builder= buffer and runs a
=query-replace-regexp= with it in the original buffer.

#+BEGIN_SRC emacs-lisp
  (require 're-builder+)
#+END_SRC
** strings                                           :strings:Lisp:Internals:
Add various string manipulation functions to Emacs
#+BEGIN_SRC emacs-lisp
  (use-package strings
    :config
      (add-hook 'pre-command-hook 'erase-nonempty-inactive-minibuffer))
#+END_SRC
*** TODO Ensure the second command doesn't create any conflicts with other packages
** undo-tree                                         :undotree:Undo:Editing:
Use =undo-tree-visualize= to visually navigate your entire undo history (as a
tree, naturally), change branches, etc.
#+BEGIN_SRC emacs-lisp
  (use-package undo-tree
    :diminish undo-tree-mode
    :init     (global-undo-tree-mode))
#+END_SRC
** yasnippet                               :yasnippet:Completion:Templating:
Yet Another Snippet is a templating package for Emacs, enabling rapid template
creation and reuse. Snippets for use in =foo-mode= should be store in the
=~/.emacs.d/snippets/foo-mode= directory to ensure they're loaded
automatically.
#+BEGIN_SRC emacs-lisp
  (use-package yasnippet
    :config
      ; Override built-in snippet directories
      ;
      ; NOTE: ~/.emacs.d/snippets should ALWAYS be the first directory
      ; in this list, since we want it to override all other snippet
      ; commands in other directories (preference is always given to
      ; earlier instance of a given key in the list) and to be the
      ; default save location for new snippets. Accordingly, don't use
      ; add-to-list if you're going to add a directory to this
      ; list. (add-to-list pushes its second argument onto the top of
      ; its first.) Instead, use
      ;
      ;     (setq yas-snippet-dirs (append yas-snippet-dirs
      ;                                '(<other directories>))
      ;
      ; to add <other directories> to the list.
      (setq yas-snippet-dirs
        '("~/.emacs.d/snippets" "~/Downloads/ThirdPartySnippets"))
      (yas-reload-all)
      (yas-global-mode 1))
#+END_SRC
*** TODO Look into Emacs's built-in templating functionality (like abbrev, skeletons, etc.)
=yasnippet= is fantastic for creating simple text replacement templates
(possibly involving variables), but it lacks certain killer pieces of
functionality that I'd love to see. For instance, in LaTeX modes,
** TODO Color-identifiers-mode (Unique display colors for unique variables)
** TODO Origami: A Multi-Language Folding Mode
** TODO Visible-Mark: Make the Current Mark Visible
** DISABLED Packages
Here is a list of packages that I used to load globally but whose
functionality has been replaced by something else.
*** (DISABLED) Auto-YASnippet: Create Temporary YASnippets
Create a temporary snippet for reproducing similar code repeatedly in
a file. To get an idea of how to use this, the following example is
provided by the package.
#+SRC_NAME: Auto-YASnippet_JavaExample
#+BEGIN_EXAMPLE
  In Java write:
  class Light$On implements Runnable {
    public Light$On() {}
    public void run() {
      System.out.println("Turning $on lights");
      light = $true;
    }
  }
  This differs from the code that you wanted to write only by 4 $ chars.
  Since it's more than one line, select the region and call `create-auto-yasnippet'.
  The $ chars disappear, yielding valid code.
  `*current-auto-yasnippet-template* becomes:
  "class Light$1 implements Runnable {
    public Light$1() {}
    public void run() {
      System.out.println(\"Turning $2 lights\");
      light = $3;
    }
  }"
#+END_EXAMPLE
#+BEGIN_SRC emacs-lisp :tangle no
  (use-package auto-yasnippet
    :bind
      ("H-w" . aya-create)
      ("H-y" . aya-expand))
#+END_SRC
**** *Update (2016-05-04):* Disable auto-yasnippet
I've disabled this package since I have yet to actually use
it. I don't see a good use case for it that in my work that isn't
already covered by other packages (or could be covered in a more
broadly-applicable manner, e.g., by the multiple-cursors package). The
package does its job great, though, so I've left it here in case I
wish to enable it in the future, possibly for specific modes instead
of globally.
*** Company (Auto-Completion Support): COMPlete ANYthing :company:Completion:Templating:
#+BEGIN_SRC emacs-lisp :tangle no
  (use-package company
    :after yasnippet
    :config
      (add-hook 'after-init-hook 'global-company-mode)
      (global-company-mode)

      ; Set # of seconds after typing and before suggestions are shown
      (setq company-idle-delay 0.5)

      ; Weight suggestions by use frequency
      (setq company-transformers '(company-sort-by-occurrence))
#+END_SRC
The configuration here that ensures yasnippet and company play well
together is adapted from [[https://www.reddit.com/r/emacs/comments/3r9fic/best_practicestip_for_companymode_andor_yasnippet/][this reddit post]].
#+BEGIN_SRC emacs-lisp :tangle no
      ;; Code for yasnippet compatibility
      ; Add yasnippet support for all company backends
      ;     (See https://github.com/syl20bnr/spacemacs/pull/179)
      (defvar company-mode/enable-yas t
              "Enable yasnippet for all company backends.")
      (defun company-mode/backend-with-yas (backend)
        "Add `company-yasnippet' to the backend if it is not already
        present and yasnippet is enabled in company mode. Otherwise do
        nothing."
        (if (or (not company-mode/enable-yas)
                (and (listp backend)
                  (member 'company-yasnippet backend)))
            backend
            (append (if (consp backend) backend (list backend))
              '(:with company-yasnippet))))
      ; Apply the company-mode/backend-with-yas function to all
      ; company backends (if yasnippet is enabled in company mode).
      (setq company-backends (mapc #'company-mode/backend-with-yas
                                   company-backends))
      ;; End of company/yasnippet compatibility code
#+END_SRC
Next we add hooks for company mode backends for particular major
modes. (I'm still debating on whether or not it would be better to
move this code down to where each major mode is defined, but it will
stay here for the time being, the rationale being that it will be
easier to disable/modify the full company configuration if all of this
code is in one place.)
#+BEGIN_SRC emacs-lisp :tangle no
    ;; Configure company-mode for editing LaTeX files
    (defun drmrd/company-mode/load-latex-backends ()
      ; Add LaTeX backends to company-backends
      (setq-local company-backends
        (append '((company-math-symbols-latex company-latex-commands))
                company-backends))
      ; Right-align annotation symbols in completion windows
      (setq-local company-tooltip-align-annotations t))
  )
#+END_SRC

*** (Disabled) Display the Current Directory                     :uniquify:
#+BEGIN_SRC emacs-lisp :tangle no
  ;; Help ensure displayed buffer names are unique for files with the
  ;; same names.
  (use-package uniquify
    :config (setq uniquify-buffer-name-style 'forward)) ; /foo/bar/baz
#+END_SRC
* Performance Settings
The following settings improve the performance of Emacs in various
ways, typically by permitting it to assume our computer wasn't built
in the stone age. They also provide various methods by which we can
benchmark our init settings.

Other ideas for speeding up Emacs can be found in
[[https://www.reddit.com/r/emacs/comments/2094tl/how_can_i_improve_emacs_performance/][this reddit thread]], from which several of the functions/ideas that
follow were taken.
** Force Emacs to fully redraw windows *before* processing queued input events
The following should dramatically reduce the amount of screen tearing
you see while working with Emacs.
#+BEGIN_SRC emacs-lisp :tangle no
  (setq redisplay-dont-pause t)
#+END_SRC
*** TODO Remove this setting after updating to Emacs v. 24.5 on all machines
This setting is the default behavior in Emacs v. 24.5 and higher, and
I read in a comment somewhere (confirm this) that the above variable
is going to be deemed deprecated soon. Alternatively (and better),
just wrap this command in a version check.
* Major Mode Customization
#+SRC_NAME major_modes_section_marker
#+BEGIN_SRC emacs-lisp
  ;;;; Major Mode Customizations
#+END_SRC
** CC Mode: Editing in C-like languages             :CCmode:C:Cpp:Java:Perl:
*** Code Style and Indentation                      :Indentation:CodeStyle:
#+SRC_NAME CC-mode
#+BEGIN_SRC emacs-lisp
  ;; By default, CC modes use the "gnu" coding style, which means code
  ;; will look like the following by default:
  ;;
  ;;     if(foo)
  ;;       {
  ;;         bar++;
  ;;       }
  ;;
  ;; Since this is uncomfortably ugly, we change it to the more
  ;; civilized "linux" coding style used in Linux kernel development.
  (setq c-default-style "linux")

  ;; While we're at it, let's set the default "tab" size to be four
  ;; spaces.
  (setq c-basic-offset 4)

  ;; Indent cases within switch statements.
  (c-set-offset 'case-label '+)
#+END_SRC
** Info Mode: Adding custom sections to =*info*=
#+SRCNAME info-mode-custom-directories
#+BEGIN_SRC emacs-lisp
  ;; Add `[.emacs.d/]info/' to the Info-mode directory list, a custom
  ;; directory containing documentation that we'd like to add to
  ;; info-mode.
  (add-to-list 'Info-default-directory-list
               (expand-file-name "./info/" user-emacs-directory))
#+END_SRC
*** TODO Create custom info files for modes that don't supply them (and personal notes)
** Use Terminals Within Emacs
** TODO eww: Internet browser integrated into Emacs
Beginning in v24.4, Emacs comes equipped with an internet browser
=eww= that supports basic HTML and CSS.
*** Usage Notes
- =eww= will only run on versions of Emacs compiled with libxml2. (In
  fact, you can tell whether or not your emacsen are running libxml2
  by trying to use =eww= to access a website; it should complain about
  it almost immediately.) It also appears that the version of Emacs
  attainable through =apt-get= (at least on Linux Mint, between
  early-2015 and mid-2016) was not compiled with libxml2.
** TODO Change Log Mode
[[help:change-log-mode][=change-log-mode=]] is enabled by default for files case-insensitively
entitled =CHANGELOG=. While I'm sure this is a wonderful mode for
certain changelogs, it defaults to 8 spaces of indentation in the body.
** Emacs-Lisp Mode
We use the built-in emacs-lisp-mode for editing .el files, but with a
couple quality of life tweaks incorporated.
*** Fix electric-indent-mode when in Emacs-Lisp mode
The following code addresses an oddity in the interaction between
Electric Indent Mode and Emacs-Lisp Mode. Without it, hitting return
on a line beginning with a semi-colon in an elisp file will result in
that line being indented by 40-ish characters.

See the following if similar issues arise in other modes:
    http://emacs.stackexchange.com/q/3322
    http://emacs.stackexchange.com/q/9563

#+BEGIN_SRC emacs-lisp
  (defun electric-indent-mode-remove-newline-from-indent-chars ()
         "Delete newline (?\n) from `electric-indent-chars'."
         (setq electric-indent-chars (delq 10 electric-indent-chars)))
  (add-hook 'emacs-lisp-mode-hook #'electric-indent-mode-remove-newline-from-indent-chars)
#+END_SRC

** Helm                                          :helm:Completion:Navigation:
An /extremely/ versatile framework for manipulating, searching, etc. within data
sources of all kinds. Helm and its extensions allow everything from completely
replacing =ido= and =smex= for finding files and commands to controlling Spotify
from within Emacs. This is my second attempt to switch to =helm= from =ido=, and
I think I'll stick with it this time around.

#+SRC_NAME load_helm_library
#+BEGIN_SRC emacs-lisp
  (org-babel-load-file (expand-file-name "~/.emacs.d/lib/helm.org"))
#+END_SRC
** (La)TeX Mode
Next we load the file ~/.emacs.d/lib/latex.org, which contains and/or
dynamically loads all of our custom LaTeX settings.
#+SRCNAME load-latex-config
#+BEGIN_SRC emacs-lisp
  ;;; (La)TeX Mode
  ;;;
  ;;;     Loads our configuration library for LaTeX-related major modes
  ;;;     and AUCTeX. Naturally it is primarily focused on `TeX-mode'
  ;;;     and `LaTeX-mode', but it also includes settings and hooks for,
  ;;;     e.g., `outline-minor-mode', the `outline-magic' package, and
  ;;;     (depending on my mood) `preview-latex'.
  (org-babel-load-file (expand-file-name "~/.emacs.d/lib/latex.org"))
#+END_SRC
** Org Mode
Our Org mode configuration has been slowly but surely growing to a
size where it now deserves its own config library.
#+SRCNAME load-org-config
#+BEGIN_SRC emacs-lisp
  ;;; Org-Mode
  ;;;
  ;;;     Loads our Org-mode config library. This includes customization
  ;;;     for all official and community `org-*' modes/packages (e.g.,
  ;;;     both `org-agenda', `org-babel', and `org-pomodoro'), in
  ;;;     addition to general org tweaks.
  (org-babel-load-file (expand-file-name "~/.emacs.d/lib/org.org"))
#+END_SRC
** Magit                                          :magit:Git:VersionControl:
[[info:magit#Top][Magit]] is a Git porcelain (aka frontend) for Emacs. We load Magit and
bind C-x g to the magit-status function (really the only command
you'll ever invoke).

Use "s" to stage a file, "c c" to start a commit, "C-c C-c" to finish
a commit, "b b" to switch branches, "P P" to do a git push, and "F F"
to do a git pull. [Tab] is also a nice key.

#+SRCNAME load-and-configure-magit
#+BEGIN_SRC emacs-lisp :tangle yes
  (use-package magit
    :init (remove-hook 'find-file-hook 'vc-find-file-hook)
          ;; Hide magit's work in progress mode lighters.
          (delight '((magit-wip-after-save-mode nil)
                     (magit-wip-after-apply-mode nil)
                     (magit-wip-before-change-mode nil)))
          ;; Make magit highlight actual changes in lines in a brighter color
          ;; than the rest of the current hunk. Set to 'all to do this in all
          ;; hunks instead (or nil to disable this).
          (setq magit-diff-refine-hunk t)
          ;; Enable commit style convention checking with recommended defaults
          (setq git-commit-style-convention-checks '(non-empty-second-line
                                                     overlong-summary-line)
                git-commit-summary-max-length 52
                git-commit-fill-column 72)
    :config ;; Disable magit-auto-revert-mode
            (magit-auto-revert-mode -1)
            ;; Enable all of magit's WIP modes
            (magit-wip-after-save-mode)
            (magit-wip-after-apply-mode)
            (magit-wip-before-change-mode)
            ;; Enable pushing to origin HEAD:refs/for/develop (for use with Gerrit)
            ;; by hitting 'R' in magit's push popup.
            (magit-define-popup-action 'magit-push-popup
              ?R "refspecs to origin HEAD:refs/for/develop"
              '(lambda () (interactive)
                 (magit-push-refspecs "origin" "HEAD:refs/for/develop" nil)))
    :bind ("C-x g" . magit-status))
#+END_SRC
** mu4e
An actively developed and feature-full email client in Emacs. See the wonderful
[[http://www.djcbsoftware.nl/code/mu/mu4e/index.html#SEC_Contents][manual]] for all your basic installation and configuration needs.

#+SRC_NAME load_mu4e_config
#+BEGIN_SRC emacs-lisp
  (org-babel-load-file (expand-file-name "~/.emacs.d/lib/mu4e.org"))
#+END_SRC
*** TODO Fail gracefully on systems without mu(4e) installed
** Visible Mark Mode                       :Mark:Regions:Navigation:Appearance:UI:
Make the current mark visible in each buffer.
#+SRC_NAME load_visible-mark-mode
#+BEGIN_SRC emacs-lisp
  (use-package visible-mark :ensure t
    :config (visible-mark-mode))
#+END_SRC
** Volatile Highlight Mode               :Changes:Appearance:UI:Highlighting:
Highlight all changes made to the current buffer since a recent command. Great
for keeping track of what you're saving in an unobtrusive way. Depending on your
theme it can be a super subtle but great quality of life improvement.
#+SRC_NAME load_volatile-highlights-mode
#+BEGIN_SRC emacs-lisp
  (use-package volatile-highlights
    :config (volatile-highlights-mode)
    :diminish volatile-highlights-mode)
#+END_SRC
* Emacs Server Setup
This is currently handled in our [[file:~/.bashrc][.bashrc]] config.
* Clean Up
** Close Extra Frames in Aquamacs
For some reason (in Aquamacs only) my configuration files open
multiple frames as they're being processed. So we close them after
loading everything. At present, this doesn't seem to work.
#+BEGIN_SRC emacs-lisp
  (if (eq system-type 'darwin)
    (delete-other-frames))
#+END_SRC
** Disable Debugging
Now that we've loaded all of our config files, disable debugging.
#+BEGIN_SRC emacs-lisp
  (setq debug-on-error nil)
  (setq debug-on-quit nil)
#+END_SRC
*** TODO Disable debug-on-error when things are running smoothly
** Record when config finishes loading
Record the time when all config files have finished loading.
#+BEGIN_SRC emacs-lisp
  (message (concat "Finished loading Emacs configuration at " (format-time-string "%I:%M%p (%S.%3Ns)")))
#+END_SRC

* Footnotes
[fn:specialfcn] A /special/ function or form here will mean one that
takes at least one or more distinguished arguments followed by a
"body" (an arbitrary number of s-expressions in which the final
expression's value is returned). Examples include =if=, =let=,
=with-current-buffer=, etc.
