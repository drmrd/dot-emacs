;;;
;;; DRMRD's Emacs Init File for OSX
;;;
;;; Last Updated: 2015-06-25
;;;

;;;
;;; NOTE: When opened Aquamacs loads elisp code contained in the
;;; following files:
;;; 
;;;     ~/.emacs
;;;     ~/Library/Preferences/Aquamacs Emacs/Preferences.el
;;;     ~/Library/Preferences/Aquamacs Emacs/customizations.el
;;;
;;; where the last file is automatically written when you "Save
;;; Options" in an Aquamacs menu.
;;;
;;; The advantage to using this god awful Preferences.el file is that
;;; it overrides automatically-generated customizations while code in
;;; your .emacs file won't.
;;;
;;; Aquamacs will also find libraries contained in
;;;
;;;     ~/Library/Preferences/Aquamacs Emacs/Preferences.el
;;;
;;; which is why I'll be moving them there from "~/.emacs.d" I think.
;;;


(require 'package)
(package-initialize)
(setq package-archives
'(("ELPA" . "http://tromey.com/elpa/")
   ("gnu" . "http://elpa.gnu.org/packages/")
   ("melpa" . "http://melpa.milkbox.net/packages/")
   ("marmalade" . "http://marmalade-repo.org/packages/")))


;; Add ~/workspace/elisp to load-path (but no subdirectories)
(add-to-list 'load-path "~/workspace/elisp")
(add-to-list 'load-path "~/.emacs.d")

;;
;  Load Emacs Starter Kit Files
;  (Disabled due to bugs with Aquamacs...I think...)
;(add-to-list 'load-path "~/.emacs.d/emacs24-starter-kit")
;(load "init.el" nil t t)

(load "auctex.el" nil t t)
(load "preview-latex.el" nil t t)

;;
;  global_indentation
;
;      Contains all global customizations pertaining to indentation,
;      whitespace, and fill commands.
(load-library "global_indentation")

;; 
;  ido-mode
;  
;  Enable ido-mode for better buffer and file switching
(ido-mode t)
    
    ;;
    ;  Configuring Ido Mode, based on the settings in the Emacs
    ;  Starter Kit
    (setq ido-everywhere            t
        ido-enable-prefix         nil
        ido-enable-flex-matching  t
        ido-auto-merge-work-directories-length nil
        ;;ido-use-filename-at-point t
        ido-max-prospects         10
        ido-create-new-buffer     'always
        ;; ido-use-virtual-buffers   t
        ;; ido-handle-duplicate-virtual-buffers 2
        ido-default-buffer-method 'selected-window
        ido-default-file-method   'selected-window)

    (setq ido-file-extensions-order     '(".cc" ".h" ".tex" ".sh" ".org"
                                      ".el" ".tex" ".png"))
    (setq completion-ignored-extensions '(".o" ".elc" "~" ".bin" ".bak"
                                      ".obj" ".map" ".a" ".so"
                                      ".mod" ".aux" ".out" ".pyg"
                                      "_flymake.tex" ".fdb_latexmk"
                                      ".log" ".fls"))
    (setq ido-ignore-extensions t)
    
    ;;
    ;  Order resuts vertically, rather than horizontally
    (setq ido-decorations (quote ("\n-> " "" "\n " "\n
  ..." "[" "]" " [No match]" " [Matched]" " [Not readable]" "
  [Too big]" " [Confirm]")))
    (defun ido-disable-line-truncation () (set (make-local-variable 'truncate-lines) nil))
    (add-hook 'ido-minibuffer-setup-hook 'ido-disable-line-truncation)


;;
;  Enable Ido Mode-like matching for M-x
;(global-set-key (kbd "M-x") 'smex)


;; Display line numbers in all modes
(global-linum-mode 1)
(setq linum-format "%4d \u2502 ")

;; Load the following files by default
;(find-file "~/workspace/glossary/glossary.tex")

;; Disable auto-fill-mode (for now)
(auto-fill-mode -1)
(remove-hook 'text-mode-hook #'turn-on-auto-fill)
(remove-hook 'latex-mode-hook #'turn-on-auto-fill)
(remove-hook 'LaTeX-mode-hook #'turn-on-auto-fill)

;;
;  Fixes electric-indent-mode when in emacs-lisp-mode
;
;      Without this code, hitting return on a line beginning with a
;      semi-colon in an elisp file will indent that line by 40-ish
;      characters.
;
;      See the following if similar issues arise in other modes:
;          http://emacs.stackexchange.com/q/3322
;          http://emacs.stackexchange.com/q/9563
(defun electric-indent-mode-configure ()
  "Delete newline (?\n) from `electric-indent-chars'."
  (setq electric-indent-chars (delq 10 electric-indent-chars)))
(add-hook 'emacs-lisp-mode-hook #'electric-indent-mode-configure)

;; Enable re-builder for regexp searches
(require 're-builder)
(setq reb-re-syntax 'string)

;; Load color-theme library
(require 'color-theme)
(color-theme-initialize)
(color-theme-billw)

;; Set default directory to ~/workspace/notes
(setq default-directory "~/workspace/")

;; Set tab width to 4
(setq tab-stop-list (number-sequence 4 200 4))

;; Force emacs to only indent with spaces and never tabs
(setq-default indent-tabs-mode nil)

;; Set default font
(set-default-font "-apple-bitstream vera sans mono-medium-r-normal--0-0-0-0-m-0-mac-roman")

;; Bind .emacs to a register for easy access (Open with C-x r j e)
(set-register ?e (cons 'file "~/Library/Preferences/Aquamacs Emacs/Preferences.el"))

;; Set Default Major Mode to text-mode
(setq default-major-mode 'text-mode)
(setq require-final-newline t)

;; Display time at bottom right of buffer
(display-time)

;; Disable Cursor Blinking
(blink-cursor-mode (- (*) (*) (*)))

;; Some basic Org settings and keybindings
(add-hook 'org-mode-hook 'turn-on-font-lock) ; not needed when global-font-lock-mode is on
(global-set-key "\C-cl" 'org-store-link)
(global-set-key "\C-ca" 'org-agenda)
(global-set-key "\C-cb" 'org-iswitchb)


;;; Load custom LaTeX- and AUCTeX-specific settings
(load "~/workspace/elisp/emacs_latex")

;;; .emacs file ends here
